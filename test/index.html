<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Habbo Origins Wall of Kindness</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="header-placeholder"></div> <!-- Placeholder for header -->

    <section style="margin: 20px auto; padding: 20px; background-color: #fff; border: 2px solid #ddd; border-radius: 10px; max-width: 90%; box-sizing: border-box;">
      <div style="padding: 20px; background-color: #f9f9f9; border-radius: 10px; position: relative;">
        <p style="color: #333; font-size: 0.95em; line-height: 1.3; margin: 0;">
          <u>Hey Habbos!</u><br>
          Matthew here. Let's spread some positivity! Simply <a href="add-message.html" style="color: #ff6600; text-decoration: none;">leave a message</a> telling us something nice about a fellow Habbo.
        </p>
      </div>
    </section>

    <section>
      <h2>The Wall of Kindness</h2>
      <div id="messagesContainer">
        <p>Loading messages...</p>
      </div>
      <div id="pagination" style="text-align: center; margin: 20px 0;">
        <button id="prevButton" disabled>Previous</button>
        <button id="nextButton" disabled>Next</button>
      </div>
    </section>

    <div id="footer-placeholder"></div> <!-- Placeholder for footer -->

    <script>
      // Function to dynamically load header and footer
      function loadContent(selector, file) {
        fetch(file)
          .then(response => response.text())
          .then(data => {
            document.querySelector(selector).innerHTML = data;
          })
          .catch(error => console.error('Error loading content:', error));
      }

      // Load the header and footer
      loadContent('#header-placeholder', 'header.html');
      loadContent('#footer-placeholder', 'footer.html');

      // Existing pagination and message loading functionality
      let currentPage = 1;
      const messagesPerPage = 10;
      const airtableToken = "patJ1ygzZwHGdrzeE.086c49e787b3e28cf270914e240eade8279592e7f0aaa2206d7bc0fd41a29c11";
      const airtableBaseURL = "https://api.airtable.com/v0/app2r945tWexLP44Z/Messages";

      async function fetchMessages() {
        try {
          const response = await fetch(
            `${airtableBaseURL}?filterByFormula={Approved}=TRUE()`,
            {
              headers: {
                Authorization: `Bearer ${airtableToken}`,
                "Content-Type": "application/json",
              },
            }
          );
          const result = await response.json();
          const messages = result.records;

          // Sort and paginate messages
          messages.sort((a, b) => new Date(b.createdTime) - new Date(a.createdTime));
          const totalPages = Math.ceil(messages.length / messagesPerPage);
          displayMessages(messages, currentPage, totalPages);
          
          // Handle pagination
          const prevButton = document.getElementById("prevButton");
          const nextButton = document.getElementById("nextButton");

          prevButton.disabled = currentPage === 1;
          nextButton.disabled = currentPage === totalPages;

          prevButton.onclick = () => {
            if (currentPage > 1) {
              currentPage--;
              displayMessages(messages, currentPage, totalPages);
            }
          };

          nextButton.onclick = () => {
            if (currentPage < totalPages) {
              currentPage++;
              displayMessages(messages, currentPage, totalPages);
            }
          };
        } catch (error) {
          console.error("Error fetching messages:", error);
          document.getElementById("messagesContainer").innerHTML = "<p>Failed to load messages.</p>";
        }
      }

      function displayMessages(messages, page, totalPages) {
        const container = document.getElementById("messagesContainer");
        container.innerHTML = "";

        const start = (page - 1) * messagesPerPage;
        const end = start + messagesPerPage;
        const messagesToShow = messages.slice(start, end);

        messagesToShow.forEach((message) => {
          const yourHabbo = message.fields["Your Habbo Name"];
          const friendHabbo = message.fields["Friend Habbo Name"];
          const kindMessage = message.fields["Message"];
          const createdTime = new Date(message.createdTime);
          const submissionDate = createdTime.toLocaleDateString("en-GB");
          const submissionTime = createdTime.toLocaleTimeString("en-GB", { hour: "2-digit", minute: "2-digit", hour12: true });

          const messageBox = `
            <div class="message-box">
              <div class="avatar-container">
                <div class="avatar sender">
                  <img src="https://habboera.com/imager?habbo=${yourHabbo}&size=l&gesture=std&action=wav&direction=2&head_direction=2&headonly=0" alt="${yourHabbo}">
                  <p>${yourHabbo}</p>
                </div>
                <div class="message-content">
                  <p>${kindMessage}</p>
                  <p class="submission-time">Submitted on: ${submissionDate} @ ${submissionTime} UTC</p>
                </div>
                <div class="avatar recipient">
                  <img src="https://habboera.com/imager?habbo=${friendHabbo}&size=l&gesture=std&action=wav&direction=4&head_direction=4&headonly=0" alt="${friendHabbo}">
                  <p>${friendHabbo}</p>
                </div>
              </div>
            </div>
          `;
          container.innerHTML += messageBox;
        });
      }

      fetchMessages();
    </script>
  </body>
</html>