<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Habbo Origins Wall of Kindness</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      /* Additional styling for submission time */
      .submission-time {
        font-size: 0.85em;
        color: #666; /* Subtle color */
        text-align: center;
        margin-top: 20px; /* Increased space between bubble and time */
      }
      .pixel-message-container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <header
  style="
    display: flex;
    justify-content: flex-start; /* Left-align the logo */
    align-items: center;
    padding: 20px;
  "
>
  <div>
    <img src="logo.png" alt="Habbo Wall of Kindness" />
    <p class="subheading">
      Send a message to a special Habbo to show them how much they mean to
      you.
    </p>
  </div>
  <div style="margin-left: auto;"> <!-- Align navigation to the right -->
    <a
      href="add-message.html"
      class="add-message-link"
      style="background-color: #fff; color: #ff6600; padding: 10px 20px; border-radius: 5px; text-decoration: none; font-size: 1em;"
    >Leave a Message |</a>

    <a
      href="search.html"
      class="add-message-link"
      style="background-color: #fff; color: #ff6600; padding: 10px 20px; border-radius: 5px; text-decoration: none; font-size: 1em;"
    >Search Messages</a>
  </div>
</header>
<section style="margin: 20px auto; padding: 20px; background-color: #fff; border: 2px solid #ddd; border-radius: 10px; max-width: 90%; box-sizing: border-box;">
  <div style="padding: 20px; background-color: #f9f9f9; border-radius: 10px; position: relative;">

    <p style="color: #333; font-size: 0.95em; line-height: 1.3; margin: 0;">
      <u>Hey Habbos!</u><br>
      Matthew here. Let's spread some positivity! Simply <a href="add-message.html" style="color: #ff6600; text-decoration: none;">leave a message</a> telling us something nice about a fellow Habbo.
      <br><br>
      The wall will be open for one week. On <u>Monday, 21st October</u>, every Habbo who has sent or received a message will be entered into a prize draw to win <a href="f02b6d15-e922-44be-95b7-1096926f3105.png" target="_blank" style="color: #ff6600;">one of the prizes at random from this room</a>.
    </p>

    <p style="color: #333; font-size: 0.95em; line-height: 1.3; margin-top: 20px;">
      That means we'll have <u>22 winners</u>! Each Habbo can only be entered once, regardless of how many times their name is mentioned.
    </p>
    
    <p style="color: #333; font-size: 0.95em; text-align: center; margin-top: 20px;">
      Thanks so much for taking part in our week of kindness. |
    </p>
  </div>
</section>
<br>
    <section>
      <h2>The Wall of Kindness</h2>
      <div id="messagesContainer">
        <p>Loading messages...</p>
      </div>

      <!-- Pagination Buttons -->
      <div
        id="pagination"
        style="
          display: flex;
          justify-content: center;
          align-items: center;
          margin-top: 20px;
        "
      >
        <button id="prevPage" style="margin-right: 10px" disabled>
          Previous
        </button>
        <span id="pageIndicator">Page 1</span>
        <button id="nextPage" style="margin-left: 10px" disabled>Next</button>
      </div>
    </section>
<footer style="font-size: 0.8em; color: #999; padding: 0 20px">
  <p>
    We are not affiliated with, endorsed, sponsored, or specifically approved by Sulake Oy or its Affiliates. We may use the trademarks and other intellectual property of Habbo, which is permitted under the Habbo Fan Site Policy. The use of this Habbo Imager kindly provided by
    <a href="https://www.habboera.com" target="_blank">HabboEra</a>.
  </p>
  <p>
    Page created and maintained by
    <a href="https://x.com/OriginsMatthew" target="_blank">Matthew</a>.
  </p>
  <p>
    <a href="privacy-policy.html" style="color: #ff6600;">Privacy Policy</a>
  </p>
  <img
    src="https://habboera.com/imager?habbo=Matthew&size=m&gesture=std&action=std&direction=4&head_direction=4&headonly=0&gender=M"
    alt="Matthew's Avatar"
    style="width: 50px; height: auto; margin-top: 10px"
  />
</footer>

    <script>
      let currentPage = 1;
      const messagesPerPage = 10;

      // Function to fetch approved messages from Airtable
      async function fetchMessages() {
        const airtableToken =
          "patJ1ygzZwHGdrzeE.086c49e787b3e28cf270914e240eade8279592e7f0aaa2206d7bc0fd41a29c11";
        const airtableBaseURL =
          "https://api.airtable.com/v0/app2r945tWexLP44Z/Messages";

        try {
          const response = await fetch(
            `${airtableBaseURL}?filterByFormula={Approved}=TRUE()`,
            {
              headers: {
                Authorization: `Bearer ${airtableToken}`,
                "Content-Type": "application/json",
              },
            }
          );
          const result = await response.json();
          const messages = result.records;

          // Sort messages by creation date (newest first)
          messages.sort(
            (a, b) => new Date(b.createdTime) - new Date(a.createdTime)
          );

          // Paginate messages
          const totalPages = Math.ceil(messages.length / messagesPerPage);
          displayMessages(messages, currentPage, totalPages);

          // Show or hide pagination buttons based on the page
          const prevButton = document.getElementById("prevPage");
          const nextButton = document.getElementById("nextPage");
          const pageIndicator = document.getElementById("pageIndicator");

          prevButton.disabled = currentPage === 1;
          nextButton.disabled = currentPage === totalPages;

          prevButton.onclick = () => {
            if (currentPage > 1) {
              currentPage--;
              displayMessages(messages, currentPage, totalPages);
              pageIndicator.innerText = `Page ${currentPage} of ${totalPages}`;
              prevButton.disabled = currentPage === 1;
              nextButton.disabled = currentPage === totalPages;
            }
          };

          nextButton.onclick = () => {
            if (currentPage < totalPages) {
              currentPage++;
              displayMessages(messages, currentPage, totalPages);
              pageIndicator.innerText = `Page ${currentPage} of ${totalPages}`;
              prevButton.disabled = currentPage === 1;
              nextButton.disabled = currentPage === totalPages;
            }
          };
        } catch (error) {
          console.error("Error fetching messages:", error);
          document.getElementById("messagesContainer").innerHTML =
            "<p>Failed to load messages.</p>";
        }
      }

      function displayMessages(messages, page, totalPages) {
        const container = document.getElementById("messagesContainer");
        container.innerHTML = ""; // Clear existing messages

        const start = (page - 1) * messagesPerPage;
        const end = start + messagesPerPage;
        const messagesToShow = messages.slice(start, end);

        messagesToShow.forEach((message) => {
          const yourHabbo = message.fields["Your Habbo Name"];
          const friendHabbo = message.fields["Friend Habbo Name"];
          const kindMessage = message.fields["Message"];
          const createdTime = new Date(message.createdTime);
          const submissionDate = createdTime.toLocaleDateString("en-GB");
          const submissionTime = createdTime.toLocaleTimeString("en-GB", {
            hour: "2-digit",
            minute: "2-digit",
            hour12: true,
          });

          const messageBox = `
            <div class="message-box">
              <div class="avatar-container">
                <div class="avatar sender">
                  <img src="https://habboera.com/imager?habbo=${yourHabbo}&size=l&gesture=std&action=wav&direction=2&head_direction=2&headonly=0" alt="${yourHabbo}">
                  <p>${yourHabbo}</p>
                </div>
                <div class="message-content">
                  <div class="pixel-message-container">
                    <div class="pixel-message">
                      <p>${kindMessage}</p>
                    </div>
                    <p class="submission-time">Submitted on: ${submissionDate} @ ${submissionTime} UTC</p>
                  </div>
                </div>
                <div class="avatar recipient">
                  <img src="https://habboera.com/imager?habbo=${friendHabbo}&size=l&gesture=std&action=wav&direction=4&head_direction=4&headonly=0" alt="${friendHabbo}">
                  <p>${friendHabbo}</p>
                </div>
              </div>
            </div>
          `;
          container.innerHTML += messageBox;
        });
      }

      // Call the function to fetch messages on page load
      fetchMessages();
    </script>
  </body>
</html>
